<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Usage | Cookie Handling</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="favicon/favicon.ico">
  <link rel="shortcut icon" href="favicon/favicon.ico">
  <link rel="apple-touch-icon" type="image/png" href="favicon/apple-touch-icon">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-32x32.png">
  <link rel="manifest" type="application/json" href="favicon/site.webmanifest">
  <link rel="mask-icon" href="favicon/safari-pinned-tab.svg" color="#005f83">
  <meta name="theme-color" content="#eee">
  <meta name="msapplication-TileColor" content="#eee">
  <meta name="msapplication-config" content="favicon/browserconfig.xml">
    
    <link rel="preload" href="/Wysiwyg.CookieHandling/assets/css/0.styles.60edf2b6.css" as="style"><link rel="preload" href="/Wysiwyg.CookieHandling/assets/js/app.cd817729.js" as="script"><link rel="preload" href="/Wysiwyg.CookieHandling/assets/js/2.2256bd5f.js" as="script"><link rel="preload" href="/Wysiwyg.CookieHandling/assets/js/3.a1136ac4.js" as="script"><link rel="prefetch" href="/Wysiwyg.CookieHandling/assets/js/10.d672c9aa.js"><link rel="prefetch" href="/Wysiwyg.CookieHandling/assets/js/4.8dd06d52.js"><link rel="prefetch" href="/Wysiwyg.CookieHandling/assets/js/5.18fcfcfd.js"><link rel="prefetch" href="/Wysiwyg.CookieHandling/assets/js/6.5260bf65.js"><link rel="prefetch" href="/Wysiwyg.CookieHandling/assets/js/7.7e36f123.js"><link rel="prefetch" href="/Wysiwyg.CookieHandling/assets/js/8.8040e5ca.js"><link rel="prefetch" href="/Wysiwyg.CookieHandling/assets/js/9.270dee7a.js">
    <link rel="stylesheet" href="/Wysiwyg.CookieHandling/assets/css/0.styles.60edf2b6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Wysiwyg.CookieHandling/" class="home-link router-link-active"><img src="wy_packages.svg" alt="Cookie Handling" class="logo"> <span class="site-name can-hide">Cookie Handling</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/wysiwyg-software-design/Wysiwyg.CookieHandling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/wysiwyg-software-design/Wysiwyg.CookieHandling" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Wysiwyg.CookieHandling/installation.html" class="sidebar-link">Installation</a></li><li><a href="/Wysiwyg.CookieHandling/usage.html" class="active sidebar-link">Usage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Wysiwyg.CookieHandling/usage.html#set-up-your-cookies" class="sidebar-link">Set up your cookies</a></li><li class="sidebar-sub-header"><a href="/Wysiwyg.CookieHandling/usage.html#code-changes-php" class="sidebar-link">Code changes PHP</a></li><li class="sidebar-sub-header"><a href="/Wysiwyg.CookieHandling/usage.html#code-changes-javascript" class="sidebar-link">Code changes JavaScript</a></li><li class="sidebar-sub-header"><a href="/Wysiwyg.CookieHandling/usage.html#dealing-with-unaccepted-cookies" class="sidebar-link">Dealing with unaccepted cookies</a></li><li class="sidebar-sub-header"><a href="/Wysiwyg.CookieHandling/usage.html#detection-of-outdated-cookie-settings" class="sidebar-link">Detection of outdated cookie settings</a></li><li class="sidebar-sub-header"><a href="/Wysiwyg.CookieHandling/usage.html#reducing-the-lifetime-of-old-cookies" class="sidebar-link">Reducing the lifetime of old cookies</a></li><li class="sidebar-sub-header"><a href="/Wysiwyg.CookieHandling/usage.html#pages-without-cookie-layer" class="sidebar-link">Pages without cookie layer</a></li></ul></li><li><a href="/Wysiwyg.CookieHandling/cookielayer.html" class="sidebar-link">Cookie Layer</a></li><li><a href="/Wysiwyg.CookieHandling/customization.html" class="sidebar-link">Customization</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="usage"><a href="#usage" class="header-anchor">#</a> Usage</h1> <p>This package offers PHP and JavaScript functions to safely deal with all your cookies.</p> <h2 id="set-up-your-cookies"><a href="#set-up-your-cookies" class="header-anchor">#</a> Set up your cookies</h2> <p>This package uses a Settings.yaml to determine which cookies can be added and how to deal with them.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">Wysiwyg</span><span class="token punctuation">:</span>
  <span class="token key atrule">CookieHandling</span><span class="token punctuation">:</span>
    <span class="token key atrule">cleanUp</span><span class="token punctuation">:</span>
      <span class="token key atrule">dryrun</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">showCookieDetails</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">consentCookieName</span><span class="token punctuation">:</span> <span class="token string">'cookieConsent'</span> <span class="token comment"># cookie that stores the settings by a user</span>
    <span class="token key atrule">cookieGroups</span><span class="token punctuation">:</span>
      <span class="token key atrule">technical</span><span class="token punctuation">:</span>                      <span class="token comment"># key for a specific cookie group </span>
        <span class="token key atrule">label</span><span class="token punctuation">:</span> <span class="token string">'Technical'</span>            <span class="token comment"># to display group name in the cookie layer</span>
        <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true                </span><span class="token comment"># boolean to determine if a group cannot be disabled by the user</span>
        <span class="token key atrule">defaultValue</span><span class="token punctuation">:</span> <span class="token boolean important">true            </span><span class="token comment"># boolean to set the default for the cookie group </span>
        <span class="token key atrule">cookies</span><span class="token punctuation">:</span>                      <span class="token comment"># list of all cookies </span>
          <span class="token key atrule">cookie_a</span><span class="token punctuation">:</span>                   <span class="token comment"># key for a specific cookie</span>
            <span class="token key atrule">cookieName</span><span class="token punctuation">:</span> <span class="token string">'COOKIE_XYZ'</span>  <span class="token comment"># used to save the cookie</span>
            <span class="token key atrule">lifetime</span><span class="token punctuation">:</span> <span class="token string">'2 years'</span>       <span class="token comment"># lifetime of the cookie</span>
          <span class="token key atrule">cookie_b</span><span class="token punctuation">:</span>                   
            <span class="token key atrule">cookieName</span><span class="token punctuation">:</span> <span class="token string">'COOKIE_ZXY'</span>
            <span class="token key atrule">lifetime</span><span class="token punctuation">:</span> <span class="token string">'2 years'</span>
          <span class="token key atrule">cookie_consent</span><span class="token punctuation">:</span>
            <span class="token key atrule">cookieName</span><span class="token punctuation">:</span> <span class="token string">'cookieConsent'</span>
            <span class="token key atrule">lifetime</span><span class="token punctuation">:</span> <span class="token string">'3 months'</span>
          <span class="token key atrule">cookie_accepted</span><span class="token punctuation">:</span>
            <span class="token key atrule">cookieName</span><span class="token punctuation">:</span> <span class="token string">'cookieConsentAccepted'</span>
            <span class="token key atrule">lifetime</span><span class="token punctuation">:</span> <span class="token string">'3 months'</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Both <code>readOnly</code> and <code>defaultValue</code> are settings for the frontend display in the cookie layer.</p> <p>The lifetime of a cookie can only be specified in <b>&quot;month(s)&quot;</b> or <b>&quot;year(s)&quot;</b>.</p> <p>The cookies <code>cookieConsent</code> and <code>cookieConsentAccepted</code> are configured by this package; 'cookieConsent' stores a users cookie preferences as JSON, 'cookieConsentAccepted' stores a hash indicating whether a user has accepted the cookie notice yet / the cookie layer should be shown.</p></div> <h2 id="code-changes-php"><a href="#code-changes-php" class="header-anchor">#</a> Code changes PHP</h2> <p><b>All HTTP components you use, that set cookies need to be updated.  </b><br>
You should inject the CookieConsentService</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token comment">/**
 * @Flow\Inject
 * @var Wysiwyg\CookieHandling\Domain\Service\CookieConsentService
 */</span>
<span class="token keyword">protected</span> <span class="token variable">$cookieConsentService</span><span class="token punctuation">;</span>
</code></pre></div><p>This service gives you the opportunity to use the function <code>tryAddCookie()</code> that checks if a cookie has been accepted and adds it to the cookie jar.</p> <p>This function should replace <strong>ALL</strong> calls to <code>$response-&gt;setCookie()</code> or <code>$response-&gt;withAddedHeader('Set-Cookie', $cookie)</code>.<br>
Instead you will now call <code>$this-&gt;tryAddCookie($yourCookie)</code></p> <p><b>Before:</b></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setCookie</span><span class="token punctuation">(</span><span class="token variable">$cookieToAdd</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token keyword">OR</span>
 
<span class="token variable">$response</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withAddedHeader</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'Set-Cookie'</span><span class="token punctuation">,</span> <span class="token variable">$cookie</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><b>After:</b></p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">tryAddCookie</span><span class="token punctuation">(</span><span class="token variable">$cookieToAdd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="code-changes-javascript"><a href="#code-changes-javascript" class="header-anchor">#</a> Code changes JavaScript</h2> <p><b>Before:</b></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>$<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span>cookieName<span class="token punctuation">,</span> cookieValue<span class="token punctuation">,</span> expire<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>JavaScript offers different ways to add cookies, which means your implementation before might look different than this example.</p> <p><b>After:</b></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">WY</span><span class="token punctuation">.</span>CookieHandling<span class="token punctuation">.</span><span class="token function">tryAddCookie</span><span class="token punctuation">(</span>cookieName<span class="token punctuation">,</span> cookieValue<span class="token punctuation">,</span> expire<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="dealing-with-unaccepted-cookies"><a href="#dealing-with-unaccepted-cookies" class="header-anchor">#</a> Dealing with unaccepted cookies</h2> <p>Cookies of your domain that have not been accepted by the user through interacting with the cookie layer will be automatically deleted by the <code>CookieCleanupComponent</code>. This ensures that old cookies from your domain will not remain after a user changes their cookie preferences.</p> <p>All deleted cookies will be logged to give you the opportunity to track non-configured cookies.</p> <p>This automatic deletion of cookies can be disabled by flagging the CookieCleanupComponent to use a dry run mode.
To enable this add the following to the configuration:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">Wysiwyg</span><span class="token punctuation">:</span>
  <span class="token key atrule">CookieHandling</span><span class="token punctuation">:</span>
    <span class="token key atrule">cleanUp</span><span class="token punctuation">:</span>
      <span class="token key atrule">dryrun</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><h3 id="cookielog-module"><a href="#cookielog-module" class="header-anchor">#</a> CookieLog module</h3> <p>You can easily access the cookie log module via the Neos backend.</p> <p><img src="/Wysiwyg.CookieHandling/assets/img/cookielog.3b7682cb.png" alt="Backend view of log Module" title="Backend-Module"> <i>[click to enlarge]</i> <br> <br>
You can see two cookies in this log.<br>
The first one has a 'Configured' info badge. This is a configured cookie to which a user did not consent.<br>
The other one has an 'UNKNOWN' warning badge which indicates that there is no configuration for a cookie by this name.
<br> <br> <img src="/Wysiwyg.CookieHandling/assets/img/cookie-log-module.dcaec0b7.jpg" alt="List of logged cookie in module" title="Backend-Module"> <i>[click to enlarge]</i> <br></p> <h2 id="detection-of-outdated-cookie-settings"><a href="#detection-of-outdated-cookie-settings" class="header-anchor">#</a> Detection of outdated cookie settings</h2> <p>GDPR requires a new consent for cookies whenever the usage of cookies changes (lifetime changes, new cookies, etc.).</p> <p>This requirement is covered in this package with <code>cookieConsentVersion</code>, an extra cookie that includes a hash of the current cookie settings you have configured.
Whenever the cookie settings change a new hash is generated and if the generated hash is different to the saved version in the cookie,
the cookie layer will pop up again to force the user to give consent to the new cookie usage.
The new hash is then saved to the cookie.</p> <h2 id="reducing-the-lifetime-of-old-cookies"><a href="#reducing-the-lifetime-of-old-cookies" class="header-anchor">#</a> Reducing the lifetime of old cookies</h2> <p>Sometimes the need arises to reduce the lifetime of a cookie that users already have saved on their device. In this case
the package offers the possibility to add a setting to the affected cookie and reduce the lifetime in the following way.</p> <ol><li><p>Add <code>previousCookieSettingHash</code> with a random number to the cookie's settings like this:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">cookie_a</span><span class="token punctuation">:</span>                   
  <span class="token key atrule">cookieName</span><span class="token punctuation">:</span> <span class="token string">'COOKIE_XYZ'</span>  
  <span class="token key atrule">lifetime</span><span class="token punctuation">:</span> <span class="token string">'2 years'</span>
  <span class="token key atrule">previousCookieSettingHash</span><span class="token punctuation">:</span> <span class="token string">'123'</span>
</code></pre></div></li> <li><p>Run the command <code>./flow cookiehash:forcookie COOKIE_XYZ</code> and get the following output:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>+------------+------------------------------------------+
<span class="token operator">|</span> CookieName <span class="token operator">|</span> COOKIE_XYZ                               <span class="token operator">|</span>
<span class="token operator">|</span> Hash       <span class="token operator">|</span> 9f087fb91e6e8a9e92460b48abee09f7fc4ab1a7 <span class="token operator">|</span>
+------------+------------------------------------------+
</code></pre></div><p>or run <code>./flow cookiehash:cookiehashinformation COOKIE_XYZ</code> to see the current hash and more information</p> <div class="language-bash extra-class"><pre class="language-bash"><code> +------------+------------------------------------------+
 <span class="token operator">|</span> CookieName <span class="token operator">|</span> COOKIE_XYZ                               <span class="token operator">|</span>
 <span class="token operator">|</span> Hash       <span class="token operator">|</span> <span class="token number">123</span>                                      <span class="token operator">|</span>
 <span class="token operator">|</span> BuildHash  <span class="token operator">|</span> 9f087fb91e6e8a9e92460b48abee09f7fc4ab1a7 <span class="token operator">|</span>
 <span class="token operator">|</span> Outdated?  <span class="token operator">|</span> YES                                      <span class="token operator">|</span>
 +------------+------------------------------------------+
</code></pre></div></li> <li><p>Replace the random number in <code>previousCookieSettingHash</code> with the newly generated hash</p></li> <li><p>Reduce the lifetime in the settings of the cookie</p></li></ol> <p>On the next load of the website the cookie layer will pop up again because the configuration has changed and,
after saving the cookie settings, the cookies with a lowered lifetime will be updated.</p> <h2 id="pages-without-cookie-layer"><a href="#pages-without-cookie-layer" class="header-anchor">#</a> Pages without cookie layer</h2> <p>According to GDPR some specific pages are not allowed to be blocked by a cookie layer, for example the data privacy page.
In order to comply with the law this package offers a mixin for your documents to block the layer.
Simply add the mixin <code>Wysiwyg.CookieHandling:Mixins.CookieSettings</code> to your document types.</p> <p><b>Example:</b></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">'My.Site:ContentPage'</span><span class="token punctuation">:</span>
  <span class="token key atrule">superTypes</span><span class="token punctuation">:</span>
    <span class="token key atrule">'Wysiwyg.CookieHandling:Mixins.CookieSettings'</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><p>In the inspector of these pages you now have the possibility to switch off the cookie layer.</p> <p><img src="/Wysiwyg.CookieHandling/assets/img/cookie-settings.cf780075.jpg" alt="Backend view of inspector setting" title="Backend-Module"> <i>[click to enlarge]</i></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/wysiwyg-software-design/Wysiwyg.CookieHandling/edit/master/Documentation/usage.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">8/18/2020, 1:10:22 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Wysiwyg.CookieHandling/installation.html" class="prev">
        Installation
      </a></span> <span class="next"><a href="/Wysiwyg.CookieHandling/cookielayer.html">
        Cookie Layer
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Wysiwyg.CookieHandling/assets/js/app.cd817729.js" defer></script><script src="/Wysiwyg.CookieHandling/assets/js/2.2256bd5f.js" defer></script><script src="/Wysiwyg.CookieHandling/assets/js/3.a1136ac4.js" defer></script>
  </body>
</html>
